<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>DeBugger - Bug Swatter Idle Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Link to CSS styles -->
  <link rel="stylesheet" href="../css/style.css" />
</head>

<body>
  <!-- Title Screen -->
  <div id="title-screen">
    <button id="btn-about" class="about-button"> ? </button>
    <button id="btn-leaderboard" class="leaderboard-button">üèÜ</button>
    <div id="title-content">
      <img id="title-logo" src="../img/menu/Debuggerlogo.png" alt="Debugger Logo">

      <div id="title-buttons">
        <button id="btn-debug" class="title-button">
          <img src="../img/menu/Debug.png" alt="DEBUG">
        </button>
        <!--<button id="btn-journal">
          <img src="../img/menu/Journal.png" alt="Journal">
        </button> -->
        <button id="btn-options" class="title-button">
          <img src="../img/menu/Options.png" alt="Options">
        </button>
        <button id="btn-quit-game" class="title-button">
          <img src="../img/menu/Quit.png" alt="Quit">
        </button>
      </div>
    </div>
  </div>

  <!-- Main Game Container -->
  <div id="game-container">
    <header id="game-header">
      <button id="pause-button">
        <img src="../img/menu/PauseBtn.png" alt="Pause" class="pause-icon">
      </button>

      <div id="score-container">
        <div class="stat-item">
          <img src="../img/menu/Score.png" alt="Score" class="score-label">
          <span id="score-value" class="score-value stat-value">0</span>
        </div>

        <div class="stat-item">
          <img src="../img/menu/LVL.png" alt="LVL" class="score-label lvl-label">
          <span id="level-value" class="score-value stat-value">1</span>
        </div>
      </div>


      <div id="logo-wrapper">
        <img id="game-logo" src="../img/menu/Debuggerlogo.png" alt="Game Logo">
      </div>

      <div id="stats">
        <div class="stat-item">
          <img src="../img/menu/Money.png" alt="Money" class="stat-label">
          <span id="money-value" class="stat-value">$0.00</span>
        </div>

        <div class="stat-item">
          <img src="../img/menu/Kills.png" alt="Kills" class="stat-label">
          <span id="bugs-killed-value" class="stat-value">0</span>
        </div>
      </div>

    </header>

    <main id="game-main">
      <!-- Weapons panel on the left -->
      <aside id="weapon-panel">
        <div class="panel-title">
          <img src="../img/menu/Tools.png" alt="Tools" class="panel-title-img">
        </div>
        <button id="equip-swatter" class="weapon-button">
          <img src="../img/weapons/swatter/swatter.png" alt="" class="weapon-icon">
        </button>

        <button id="equip-hammer" class="weapon-button">
          <img src="../img/weapons/hammer/hammer.png" alt="" class="weapon-icon">
        </button>

        <button id="equip-bugzapper" class="weapon-button">
          <img src="../img/weapons/zapper/zapper.png" alt="" class="weapon-icon">
        </button>

        <!-- More weapon buttons can be added here -->

        <!-- Weapon Stats Pop-Up -->
        <div id="weapon-tooltip"></div>

      </aside>

      <!-- Play area in the center -->
      <div id="play-column">
        <div id="play-area">
          <!-- Bug Meter + Label -->
          <div id="bug-meter-container">
            <div id="bug-meter-label"><strong>BUG METER</strong></div>
            <div id="bug-meter">
              <div id="bug-meter-fill"></div>
            </div>
          </div>

          <!-- Ranged weapon anchor -->
          <img id="bugzapper-base" src="../img/weapons/zapper/zapperBase.png" alt="Bug Zapper">


          <!-- Swatter cursor -->
          <img id="swatter-cursor" src="../img/swatter.png" alt="Swatter">
        </div>
        <div id="ability-section">
          <div class="panel-title">
            <img src="../img/menu/Abilities.png" alt="Abilities" class="panel-title-img">
          </div>
          <div id="ability-bar">
            <button class="ability-button" data-ability-id="bugserk">
              <img src="../img/abilities/bugserk.png" alt="Bugserk" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Bugserk</span>
            </button>

            <button class="ability-button" data-ability-id="bug-tape">
              <img src="../img/abilities/bug_tape.png" alt="Bug Tape" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Bug Tape</span>
            </button>

            <button class="ability-button" data-ability-id="bug-drone">
              <img src="../img/abilities/bug_drone.png" alt="Cordyceps" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Cordyceps</span>
            </button>

            <button class="ability-button" data-ability-id="immortal-snail">
              <img src="../img/abilities/immortal_snail.png" alt="ImmortalSnail" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Immortal Snail</span>
            </button>

            <button class="ability-button" data-ability-id="singularity">
              <img src="../img/abilities/singularity.png" alt="Singularity" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Singularity</span>
            </button>

            <button class="ability-button" data-ability-id="slapshot">
              <img src="../img/abilities/slapshot.png" alt="Slapshot" class="ability-icon"
                onerror="this.onerror=null; this.src='../img/abilities/placeholder.png'">
              <span class="ability-label">Slapshot</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Upgrades panel on the right -->
      <aside id="upgrade-panel">
        <div class="panel-title">
          <img src="../img/menu/Upgrades.png" alt="" class="panel-title-img">
        </div>

        <div id="upgrade-list">
          <!-- 1. Increase ATK -->
          <div class="upgrade-card" data-upgrade-id="increase-atk">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/increase_attack.png" alt="Increase ATK" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="increase-atk">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Increase ATK</h3>
              <p class="upgrade-desc">
                Increases the base damage of the currently held weapon by +1.
              </p>
            </div>
          </div>

          <!-- 2. Increase RAD -->
          <div class="upgrade-card" data-upgrade-id="increase-rad">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/increase_rad.png" alt="Increase RAD" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="increase-rad">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Increase RAD</h3>
              <p class="upgrade-desc">
                Increases the radius of the currently held weapon by +5.
              </p>
            </div>
          </div>

          <!-- 3. Decrease WCD -->
          <div class="upgrade-card" data-upgrade-id="decrease-wcd">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/decrease_wcd.png" alt="Decrease WCD" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="decrease-wcd">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Decrease WCD</h3>
              <p class="upgrade-desc">
                Decreases the cooldown between strikes of the currently held weapon by -0.1s.
              </p>
            </div>
          </div>

          <!-- 4. Decrease ACD -->
          <div class="upgrade-card" data-upgrade-id="decrease-acd">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/decrease_acd.png" alt="Decrease ACD" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="decrease-acd">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Decrease ACD</h3>
              <p class="upgrade-desc">
                Decreases the cooldown between using abilities by -0.1s.
              </p>
            </div>
          </div>

          <!-- 5. Increase $$$ -->
          <div class="upgrade-card" data-upgrade-id="increase-money">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/increase_money.png" alt="Increase $$$" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="increase-money">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Increase $$$</h3>
              <p class="upgrade-desc">
                Increases amount of money gained per bug killed by 30%.
              </p>
            </div>
          </div>

          <!-- 6. Increase LVL -->
          <div class="upgrade-card" data-upgrade-id="increase-lvl">
            <div class="upgrade-top">
              <div class="upgrade-sprite-wrapper">
                <img src="../img/upgrades/increase_lvl.png" alt="Increase LVL" class="upgrade-sprite">
              </div>
              <div class="upgrade-button-wrapper">
                <button class="upgrade-button" data-upgrade-id="increase-lvl">Upgrade: $10</button>
              </div>
            </div>
            <div class="upgrade-bottom">
              <h3>Increase LVL</h3>
              <p class="upgrade-desc">
                Increases the bugs spawn rate, unlocks the next tier of upgrades and weapons, and invites your impending
                doom...
              </p>
            </div>
          </div>
        </div>
      </aside>

    </main>
  </div>

  <!--Ability tooltip pop-up-->
  <div id="ability-tooltip"></div>
  <!--Upgrade tooltip pop-up-->
  <div id="upgrade-tooltip"></div>

  <!-- Journal Screen -->
  <div id="journal-screen" class="overlay-panel">
    <div class="panel-content">
      <h2>Journal</h2>
      <p>Here you'll eventually see entries about:</p>
      <ul>
        <li>Bugs you've discovered</li>
        <li>Weapons you've unlocked</li>
        <li>Upgrades and milestones</li>
      </ul>

      <section class="journal-section">
        <h3>Bug Log (Placeholder)</h3>
        <p>ü™∞ Example Bug: ‚ÄúCommon Housefly‚Äù - weak, appears early, low reward.</p>
      </section>

      <section class="journal-section">
        <h3>Weapons (Placeholder)</h3>
        <p>üßπ Basic Swatter - your starting weapon. Reliable, but basic.</p>
      </section>

      <section class="journal-section">
        <h3>Upgrades (Placeholder)</h3>
        <p>‚¨ÜÔ∏è Damage Boost I - increases damage by 10%.</p>
      </section>

      <button class="close-btn" id="close-journal">Close</button>
    </div>
  </div>

  <!-- About Us Screen -->
  <div id="about-screen" class="overlay-panel">
    <div class="panel-content">
      <h2>About DeBugger</h2>
      <p>DeBugger was developed by:</p>
      <ul>
        <li><strong>Andrew Boland</strong> (aaboland@usca.edu) - Team Leader</li>
        <li><strong>Evan McLeod</strong> (em127@usca.edu) - Lead Artist</li>
        <li><strong>Judah Owen</strong> (jdowen@usca.edu) - Lead Developer</li>
      </ul>
      <p>Project Description: Implement a web-based bug clicker game where players
        earn money by "swatting" randomly appearing bugs.
      </p>
      <p><strong>How to DeBug:</strong>
      <p>Click on bugs as they appear to DeBug them and earn money. Use the money to upgrade your
        tools and abilities to handle more challenging bugs. When you're ready, or when you run out
        of upgrades to unlock, increase the level to face tougher challenges and unlock the next tier.</p>
      </p>
      <p>Can you survive the onslaught?</p>
      <p><strong>Get DeBuggin'!</strong></p>
      <button class="close-btn" id="close-about">Close</button>
    </div>
  </div>

  <!-- Options Screen -->
  <div id="options-screen" class="overlay-panel">
    <div class="panel-content">
      <h2>Options</h2>

      <div class="option-row">
        <label for="music-volume">Music Volume</label>
        <input type="range" id="music-volume" min="0" max="100" value="70">
      </div>

      <div class="option-row">
        <label for="sfx-volume">SFX Volume</label>
        <input type="range" id="sfx-volume" min="0" max="100" value="80">
      </div>

      <div class="option-row">
        <label>
          <input type="checkbox" id="spacebar-click-toggle">
          Spacebar for Click
        </label>
      </div>

      <p class="option-note">(Sliders are visual for now ‚Äî we‚Äôll hook them to real audio later.)</p>

      <button class="close-btn" id="close-options">Close</button>
    </div>
  </div>

  <!-- Pause Screen -->
  <div id="pause-screen" class="overlay-panel">
    <div class="panel-content pause-content">
      <img src="../img/menu/Paused.png" alt="Paused" class="overlay-title-img">

      <div class="pause-buttons">
        <button id="btn-rebug" class="overlay-button">
          <img src="../img/menu/Rebug.png" alt="Rebug" class="overlay-button-img">
        </button>
        <button id="btn-pause-options" class="overlay-button">
          <img src="../img/menu/Options.png" alt="Options" class="overlay-button-img">
        </button>
        <!--<button id="btn-pause-journal" class="overlay-button">
          <img src="../img/menu/Journal.png" alt="" class="overlay-button-img">
        </button> -->
        <button id="btn-quit" class="overlay-button">
          <img src="../img/menu/Quit.png" alt="Quit" class="overlay-button-img">
        </button>
      </div>
    </div>
  </div>

  <!-- Bugged Game Over Screen -->
  <div id="bugged-screen" class="overlay-panel">
    <div class="panel-content bugged-content">

      <div id="bugged-score-row">
        <img src="../img/menu/Score.png" alt="Score" class="bugged-score-label">
        <span class="bugged-score-separator">:</span>
        <span id="bugged-score-value" class="bugged-score-value">0</span>
      </div>

      <h2>You've been Bugged!</h2>
      <p>Place your mark in the hall of failed DeBuggers.</p>
      <!-- Initials / High Score Submission -->
      <div id="initials-entry">
        <div class="initials-row">
          <label for="player-initials">Initials:</label>
          <input id="player-initials" type="text" maxlength="3" autocomplete="off" spellcheck="false">
          <button id="submit-score-button">Submit Score</button>
        </div>
        <p id="submit-message"></p>
      </div>
      <p>Don't worry, you can just <strong>REBUG</strong> the game and try again!</p>
      <p>Or you can <strong>Quit</strong> like a Bugged coward.</p>

      <div class="bugged-buttons">
        <button id="btn-rebug-gameover" class="overlay-button">
          <img src="../img/menu/Rebug.png" alt="Rebug" class="overlay-button-img">
        </button>
        <button id="btn-quit-from-bugged" class="overlay-button">
          <img src="../img/menu/Quit.png" alt="Quit" class="overlay-button-img">
        </button>
      </div>
    </div>
  </div>

  <!-- Leaderboard Screen -->
  <div id="leaderboard-screen" class="overlay-panel">
    <div class="panel-content leaderboard-content">
      <img src="../img/menu/Leaderboard.png" alt="Leaderboard" class="overlay-title-img">

      <table id="leaderboard-list" class="ranking-list">
        <thead>
          <tr>
            <th>Rank</th>
            <th>DeBugger Mark</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody id="leaderboard-body">
          <!-- Leaderboard entries will be dynamically inserted here -->
        </tbody>
      </table>

      <button class="close-btn" id="close-leaderboard">Close</button>
    </div>
  </div>

  <!-- Scripts of JS files -->
  <script src="../js/bugs.js"></script>
  <script src="../js/weapons.js"></script>
  <script src="../js/powerups.js"></script>
  <script src="../js/projectile.js"></script>
  <script src="../js/game.js"></script>


  <!-- Firebase Database -->
  <script type="module">
    import {
      initializeApp
    } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js';

    import {
      getFirestore,
      onSnapshot,
      collection,
      query,
      orderBy,
      limit,
      addDoc
    } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCj56GT533SFfRFZUfZ3ZTrBMVVQBPsrcw",
      authDomain: "owendatabase2025.firebaseapp.com",
      projectId: "owendatabase2025",
      storageBucket: "owendatabase2025.firebasestorage.app",
      messagingSenderId: "255375433561",
      appId: "1:255375433561:web:2c88349ef48e8493fef648",
      measurementId: "G-TSJTVN6ZBP"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const quancollection = collection(db, "DeBugger");

    // üîπ Expose a global function so game.js can call it
    window.submitScoreToLeaderboard = async function (name, score) {
      try {
        await addDoc(quancollection, {
          name,
          score
        });
        console.log("Score submitted:", name, score);
      } catch (err) {
        console.error("Error submitting score:", err);
        throw err;
      }
    };

    // üîπ Listen for top 10 changes and update the leaderboard table
    const q = query(quancollection, orderBy("score", "desc"), limit(10));

    onSnapshot(q, (querySnapshot) => {
      const leaderboard = [];
      querySnapshot.forEach((doc) => {
        leaderboard.push(doc.data());
      });

      console.log("Current leaderboard: ", leaderboard);

      const tbody = document.querySelector("#leaderboard-list tbody");
      if (!tbody) return;

      // Clear existing rows
      tbody.innerHTML = "";

      // Build rows from Firestore data
      leaderboard.forEach((entry, index) => {
        const rank = index + 1;
        const name = entry.name ?? "Unknown";
        const score = entry.score ?? 0;

        const tr = document.createElement("tr");

        // Rank-based highlight (gold/silver/bronze)
        if (rank === 1) tr.classList.add("rank-gold");
        else if (rank === 2) tr.classList.add("rank-silver");
        else if (rank === 3) tr.classList.add("rank-bronze");

        const rankTd = document.createElement("td");
        rankTd.textContent = rank;

        const nameTd = document.createElement("td");
        nameTd.textContent = name;

        const scoreTd = document.createElement("td");
        scoreTd.textContent = score;

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(scoreTd);

        tbody.appendChild(tr);
      });

      // Optional: pad up to 10 rows
      for (let i = leaderboard.length; i < 10; i++) {
        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.textContent = i + 1;

        const nameTd = document.createElement("td");
        nameTd.textContent = "-";

        const scoreTd = document.createElement("td");
        scoreTd.textContent = "-";

        tr.appendChild(rankTd);
        tr.appendChild(nameTd);
        tr.appendChild(scoreTd);

        tbody.appendChild(tr);
      }
    });
  </script>

</body>

</html>